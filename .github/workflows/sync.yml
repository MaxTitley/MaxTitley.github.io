name: Notion to GitHub Sync
on:
  push:
    branches: [ main ]
  workflow_dispatch: 

jobs:
  notion_to_markdown:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Use Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install Notion Tool
        run: npm install @notionhq/client notion-to-md

      - name: Convert Notion Page
        env:
          NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
          NOTION_PAGE_ID: ${{ secrets.NOTION_PAGE_ID }}
        run: |
          node -e "
          const { Client } = require('@notionhq/client');
          const { NotionToMarkdown } = require('notion-to-md');
          const fs = require('fs');
          const notion = new Client({ auth: process.env.NOTION_TOKEN });
          const n2m = new NotionToMarkdown({ notionClient: notion });
          (async () => {
            const mdblocks = await n2m.pageToMarkdown(process.env.NOTION_PAGE_ID);
            const mdString = n2m.toMarkdownString(mdblocks);
            fs.writeFileSync('index.md', mdString.parent);
          })();"

      - name: Commit and Push
        run: |
          git config --global user.name 'GitHub Action'
          git config --global user.email 'action@github.com'
          git add index.md
          git commit -m "Update portfolio from Notion" || echo "No changes to commit"
          git push
